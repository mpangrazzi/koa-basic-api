
/**
 * Global error handling middleware
 */

module.exports = function * error (next) {

  try {
    yield next
  } catch (e) {

    this.app.emit('error', e, this)
    this.status = e.status || 500

    this.body = this.accepts('json') ? {
      status: 'ko',
      exception: e
    } : message

  }

}
