
/**
 * Global error handling middleware
 */

module.exports = function *error(next) {

  try {
    yield next;
  } catch (e) {

    this.app.emit('error', e, this);
    this.status = e.status || 500;

    if (this.accepts('json')) {

      this.body = {
        status: 'ko',
        exception: e
      };

    }
    else {
      this.body = message;
    }

  }

};
